---
name: Refactor config filename generation
overview: Refactor config filename generation to use format `{location_lowercase}_exvpn.conf` instead of `amnezia_{app_type}.conf`. Create single function in bot/management/ that returns ready filename and import it in both routers.
todos:
  - id: create_filename_generator
    content: –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é generate_config_filename() –≤ bot/management/config_filename.py –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ {location}_exvpn.conf —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, —É–¥–∞–ª–µ–Ω–∏–µ–º —ç–º–æ–¥–∑–∏ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π
    status: completed
  - id: update_locations_router
    content: "–û–±–Ω–æ–≤–∏—Ç—å bot/routers/locations.py: –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å generate_config_filename –∏–∑ bot.management.config_filename –∏ –∑–∞–º–µ–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ generate_config_filename(cluster.name)"
    status: completed
    dependencies:
      - create_filename_generator
  - id: update_profile_router
    content: "–û–±–Ω–æ–≤–∏—Ç—å bot/routers/profile.py: –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å generate_config_filename –∏–∑ bot.management.config_filename –∏ –∑–∞–º–µ–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ generate_config_filename(cluster_name)"
    status: completed
    dependencies:
      - create_filename_generator
  - id: check_dependencies
    content: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–º–æ–¥–∑–∏ (emoji) –≤ pyproject.toml (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å regex)
    status: completed
---

# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥–æ–≤

## –¶–µ–ª—å

–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥–∞ —Å `amnezia_{app_type}.conf` –Ω–∞ `{location_lowercase}_exvpn.conf`, –≥–¥–µ `location_lowercase` - –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ (–ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫, —É–¥–∞–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏, lowercase, –∑–∞–º–µ–Ω–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –Ω–∞ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ).

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

**–§–∞–π–ª:** `bot/management/config_filename.py` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `generate_config_filename(location_name: str) -> str`, –∫–æ—Ç–æ—Ä–∞—è:

- –£–¥–∞–ª—è–µ—Ç —ç–º–æ–¥–∑–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `emoji`)
- –ü–µ—Ä–µ–≤–æ–¥–∏—Ç —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ lowercase
- –ó–∞–º–µ–Ω—è–µ—Ç –ø—Ä–æ–±–µ–ª—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –Ω–∞ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ
- –£–¥–∞–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ `{normalized_location}_exvpn.conf`

–°–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã:

- `"–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã"` ‚Üí `"netherlands"`
- `"–ì–µ—Ä–º–∞–Ω–∏—è"` ‚Üí `"germany"`
- `"–°–®–ê"` ‚Üí `"usa"`
- –ò –¥—Ä—É–≥–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è

–ü—Ä–∏–º–µ—Ä—ã:

- `"üá≥üá± –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã"` ‚Üí `"netherlands_exvpn.conf"`
- `"üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è"` ‚Üí `"germany_exvpn.conf"`
- `"üá∫üá∏ –°–®–ê"` ‚Üí `"usa_exvpn.conf"`

### 2. –û–±–Ω–æ–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –≤ locations.py

**–§–∞–π–ª:** `bot/routers/locations.py`

–í —Ñ—É–Ω–∫—Ü–∏–∏ `generate_key_handler` (—Å—Ç—Ä–æ–∫–∞ ~157):

- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `generate_config_filename` –∏–∑ `bot.management.config_filename`
- –ó–∞–º–µ–Ω–∏—Ç—å `filename=f"amnezia_{app_type.split('_')[-1]}.conf" `–Ω–∞ `filename=generate_config_filename(cluster.name)`
- `app_type` –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è peer —á–µ—Ä–µ–∑ API –∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ caption, –Ω–æ –Ω–µ –¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

### 3. –û–±–Ω–æ–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –≤ profile.py

**–§–∞–π–ª:** `bot/routers/profile.py`

–í —Ñ—É–Ω–∫—Ü–∏–∏ `my_keys_handler` (—Å—Ç—Ä–æ–∫–∞ ~122):

- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `generate_config_filename` –∏–∑ `bot.management.config_filename`
- –ó–∞–º–µ–Ω–∏—Ç—å `filename = f"amnezia_{peer.app_type.split('_')[-1]}.conf" `–Ω–∞ `filename = generate_config_filename(cluster_name)`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cluster_name`, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –ø–æ–ª—É—á–µ–Ω –∏–∑ `cluster.name` (—Å—Ç—Ä–æ–∫–∞ 112)

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–§–∞–π–ª:** `pyproject.toml`

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç–º–æ–¥–∑–∏. –ï—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –¥–æ–±–∞–≤–∏—Ç—å:

- `emoji` (–¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–º–æ–¥–∑–∏) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- `app_type` **–≤—Å–µ –µ—â–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω** –¥–ª—è:
- API –∑–∞–ø—Ä–æ—Å–æ–≤ (`CreatePeerRequest`)
- –ü–æ–∏—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö peer (`find_by_client_cluster_apptype`)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI (caption —Å —Ç–∏–ø–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º)
- –ò–∑–º–µ–Ω—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** —Ñ–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞, –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å `app_type` –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å edge cases:
- –ü—É—Å—Ç—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π
- –ù–∞–∑–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–∑ —ç–º–æ–¥–∑–∏
- –ù–∞–∑–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Å–ª–æ–≤–∞—Ä–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (fallback –Ω–∞ —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—é –∏–ª–∏ –∏—Å—Ö–æ–¥–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö
- –°–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–º –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ª–æ–∫–∞—Ü–∏–π —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã" ‚Üí "netherlands")
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ª–æ–∫–∞—Ü–∏–π —Å —ç–º–æ–¥–∑–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "üá≥üá± –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã" ‚Üí "netherlands")
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ª–æ–∫–∞—Ü–∏–π —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù—å—é –ô–æ—Ä–∫" ‚Üí "new_york")
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö (locations.py –∏ profile.py)
- Fallback –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç—Ä–∞–Ω