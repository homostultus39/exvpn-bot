# ExVPN Bot

Telegram –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Central API.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º:

- **core/** - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (API –∫–ª–∏–µ–Ω—Ç, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –∏—Å–∫–ª—é—á–µ–Ω–∏—è)
- **entities/** - –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (Client, Cluster, Peer, User, Subscription)
- **routers/** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback'–æ–≤
- **keyboards/** - –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞–¥–º–∏–Ω–∞
- **messages/** - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **middlewares/** - –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞)
- **management/** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ dependency injection

## –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –ø—Ä–∏–Ω—è—Ç–∏–µ–º —É—Å–ª–æ–≤–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ü–æ–∫—É–ø–∫–∞ –∏ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ (—Ç–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –¥–ª—è –¥–µ–±–∞–≥–∞)
- –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è –∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—é—á–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π –¥–ª—è —Ä–µ–≥–∏–æ–Ω–æ–≤

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∫–ª–∏–µ–Ω—Ç—ã, –∫–ª–∞—Å—Ç–µ—Ä—ã, –ø–∏—Ä—ã)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.14+
- Poetry (–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏)
- Docker –∏ Docker Compose (–¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏)
- –ó–∞–ø—É—â–µ–Ω–Ω—ã–π Central API

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd exvpn-bot-1
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
cp .env .env.local
```

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:

```env
# Telegram Bot
API_TOKEN=your_bot_token
ADMIN_IDS=123456789,987654321

# Central API
CENTRAL_API_URL=http://localhost:8000/api/v1
CENTRAL_API_USERNAME=admin
CENTRAL_API_PASSWORD=secret

# Clusters (—Ñ–æ—Ä–º–∞—Ç: CODE:EMOJI NAME:UUID)
CLUSTERS=NL:üá≥üá± –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã:uuid-nl,DE:üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è:uuid-de,US:üá∫üá∏ –°–®–ê:uuid-us

# URLs
PRIVACY_POLICY_URL=https://telegra.ph/your-privacy-policy
USER_AGREEMENT_URL=https://telegra.ph/your-user-agreement

# Payment (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret_key

# Database
DATABASE_PATH=./data/bot.db
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
poetry install
```

### 4. –ó–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
poetry run python -m bot.main
```

### 5. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
docker-compose up -d --build
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- `/start` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `üîë –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á` - –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `üë§ –ü—Ä–æ—Ñ–∏–ª—å` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ –∏ –∫–ª—é—á–∞—Ö
- `üíé –ü–æ–¥–ø–∏—Å–∫–∞` - –ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

### –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

- `/admin` - –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- `üåê –ö–ª–∞—Å—Ç–µ—Ä—ã` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏
- `üë• –ö–ª–∏–µ–Ω—Ç—ã` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
- `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞` - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
bot/
‚îú‚îÄ‚îÄ main.py                      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ management/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py          # DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ api_client.py           # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                 # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py           # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îú‚îÄ‚îÄ client/                 # –ö–ª–∏–µ–Ω—Ç—ã VPN
‚îÇ   ‚îú‚îÄ‚îÄ cluster/                # VPN —Å–µ—Ä–≤–µ—Ä—ã/—Ä–µ–≥–∏–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ peer/                   # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–∫–ª—é—á–∏)
‚îÇ   ‚îú‚îÄ‚îÄ subscription/           # –ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Ç–∞—Ä–∏—Ñ—ã
‚îÇ   ‚îî‚îÄ‚îÄ user/                   # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îú‚îÄ‚îÄ start.py                # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ locations.py            # –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ subscription.py         # –ü–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ profile.py              # –ü—Ä–æ—Ñ–∏–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ admin/                  # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îú‚îÄ‚îÄ keyboards/                  # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ messages/                   # –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îú‚îÄ‚îÄ middlewares/                # Middleware
‚îî‚îÄ‚îÄ utils/                      # –£—Ç–∏–ª–∏—Ç—ã
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Central API

–ë–æ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å Central API —á–µ—Ä–µ–∑ —Å–ª–µ–¥—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

- `POST /auth/login` - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /auth/refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `GET /clients/` - –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
- `POST /clients/` - –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- `PATCH /clients/{id}` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- `GET /clusters/` - –°–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- `POST /clusters/{id}/restart` - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞
- `POST /peers/` - –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ (peer)
- `GET /peers/` - –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –∫–æ–¥–∞

- **DRY** - Don't Repeat Yourself
- **SOLID** - Single Responsibility, Open/Closed, Liskov Substitution, Interface Segregation, Dependency Inversion
- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ—è–º –∏ —Å—É—â–Ω–æ—Å—Ç—è–º
- **–ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤** - –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º—ã–º
- **Type hints** - –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∏–ø—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å—É—â–Ω–æ—Å—Ç—å (entities/)
2. –°–æ–∑–¥–∞–π—Ç–µ models.py —Å pydantic –º–æ–¥–µ–ª—è–º–∏
3. –°–æ–∑–¥–∞–π—Ç–µ repository.py –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
4. –°–æ–∑–¥–∞–π—Ç–µ service.py –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
5. –°–æ–∑–¥–∞–π—Ç–µ router –≤ routers/
6. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ router –≤ main.py

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `bot/data/bot.log` –∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.

–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: INFO

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–≤—è–∑–∏ telegram_id ‚Üî client_id.

–ü—É—Ç—å –∫ –ë–î: `./bot/data/bot.db` (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ DATABASE_PATH)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–µ–π –±–µ–∑ –æ–ø–ª–∞—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "üß™ –¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞" –≤ –º–µ–Ω—é –ø–æ–¥–ø–∏—Å–æ–∫. –û–Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 30 –¥–Ω–µ–π.

## Troubleshooting

### –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å API

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- CENTRAL_API_URL –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω
- CENTRAL_API_USERNAME –∏ CENTRAL_API_PASSWORD –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- API –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω

### –ù–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–ª—é—á–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ö–ª–∞—Å—Ç–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ CLUSTERS
- UUID –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –≤ API
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è ./bot/data/ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ï—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å

## –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

homostultus39@gmail.com
